# Identity

## Decentralized Identitifers (DIDs)

Users are identified using a public [decentralised identifier (DID)](https://w3c.github.io/did-core/). A DID is basically a blockchain addresses (ie: `0xf3beac30c498d9e26865f34fcaa57dbb935b0d74`) that is known to be controlled by the user.

A user identifies themselves by providing their blockchain address in the DID format that also specifies the blockchain being used.

ie: `did:ethr:0xf3beac30c498d9e26865f34fcaa57dbb935b0d74` is a valid DID referencing a valid Ethereum Address.

## Multipe Personas

Users can have multiple Personas depending on context. For example, a user may have a `personal` identity and a `professional` identity. This is easily supported (and free) as a user can simply create a new DID and use that to login to any application.

It's also entirely anonymous. No information is known about the holder of the DID and no information is written to a public blockchain.

## Data Hosting &amp; Control

Data created by applications is encrypted with the user's private keys and stored in off-chain databases. By default, Verida provides hosting of these databases, however both application developers and users can take control of this data:

1. Application developers can host their own Verida Dataserver(s) and use that as the default for their application users
2. Users can host their own Verida Dataserver(s) and force an application to use that server by updating their DID document with the new server address

See the [VID Document](#vid-document) section below for details on how this is achieved.

## Verida ID (VID)

When a user connects to an application for the first time a new **VID** is created. This new identity links a specific application with a user's DID.

A **VID** also adheres to the **DID** standard.

## Encryption Keys

Creating a new **VID** creates the following keys:

- **Symmetric encryption key** &mdash; for encrypting private data
- **Asymmetric encryption key** &mdash; for encrypting data for other users and applications
- **Signing key** &mdash; for signing data

The private keys can only be generated from the consent signature generated by the user when they logged into the application. The signature is used as a seed to create a [Hierarchical Deterministic Wallet](https://www.investopedia.com/terms/h/hd-wallet-hierarchical-deterministic-wallet.asp), which in turn, is used to generate child keys.

The public keys are stored in the user's [VID Document](#vid-document).

## VID Document

When a user is created for the first time, a **VID Document** is created that provides public information about the identity.

Here's an example document:

```
{
  "_id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
  "_rev": "1-16175ffe3a8ad9004ea4268958b41f93",
  "doc": {
    "@context": "https://w3id.org/did/v1",
    "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
    "publicKey": [
      {
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#asym",
        "type": "Curve25519EncryptionPublicKey",
        "controller": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
        "publicKeyHex": "0x3a9db7d3dbc4314e60dcbe2b4e010c084d478ad24fb3c8ccbc5b01f5cf81f46b"
      },
      {
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#sign",
        "type": "Secp256k1VerificationKey2018",
        "controller": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
        "publicKeyHex": "0x1ed6be53d8ad36d5869f307ba9c5b762a86f4e9254a41e73e071356343c87580"
      }
    ],
    "authentication": [
      {
        "publicKey": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#sign",
        "type": "Secp256k1SignatureAuthentication2018"
      }
    ],
    "service": [
      {
        "description": "Verida Retail Demo",
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#application",
        "type": "verida.Application",
        "serviceEndpoint": "https://demos.alpha.verida.io:3001"
      },
      {
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#dataserver",
        "type": "verida.DataServer",
        "serviceEndpoint": "https://dataserver.alpha.verida.io:5000"
      }
    ],
    "created": "2020-02-22T01:30:08.531Z",
    "updated": "2020-02-22T01:30:08.531Z",
    "proof": {
      "alg": "ES256K",
      "signature": "Z6tkB4WJwzXceUoo+WIY3JTsfs4u4vPtfYIZzKWrASVWa5kGf1zWSYxz6uu/fGkSTrRsWgU78f9ppLtG/0lxDw=="
    }
  }
}
```

This is a public document and eanbles the following capabilities:

1. Encrypt a message for the user (`doc.publicKey.id~#asym`)
1. Verify data the user has signed (`doc.publicKey.id~#sign`)
1. Identify the server where the user's application data is stored (`doc.service.type=verida.DataServer`)
1. Identify the application and it's public URL linked to the VID (`doc.service.type=verida.Application`)

A user's DID Document can only be updated by the user signing a consent message, putting them in control over their identity.

In this way, a user could host their own dataserver. They can then update the `serviceEndpoint` value of their `doc.service.type=verida.DataServer` entry to point to their privately operated dataserver and maintain full control over their data.

## DID Server

Verida maintains a central database that maps applications to DID's and VID's. Here is an example row:

```
{
  "_id": "02d76990eda3d477c4c9d2dd32d4245e47b8bdb03a40982b3461ea4f8e8e8ed5",
  "application": "Verida Vault",
  "did": "did:ethr:0x94af6b4e0c83546549a94920ea37472da369d6b8",
  "vid": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772"
}
```

This database also maintains the **VID Documents**.

This database is accessible via a public API, used internally by the Verida Datastore library.

You can access the [Public API Source Code](https://github.com/verida/did-server). The API is currently deployed at `https://did.alpha.verida.io:5001/`

!>Therer is currently a centralised API for managing DID Documents and mappings. This will be replaced with a decentralized solution in the near future (possibly using Sidechain or Ceramic).