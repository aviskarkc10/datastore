# Identity

## Decentralized Identitifers (DIDs)

Users are identified using a public [decentralised identifier (DID)](https://w3c.github.io/did-core/). A DID is basically a blockchain addresses (ie: `0xf3beac30c498d9e26865f34fcaa57dbb935b0d74`) that is known to be controlled by the user.

A user identifies themselves by providing their blockchain address in the DID format that also specifies the blockchain being used.

There are two types of DID's used by Verida Datastore; Public blockchain DID's and Verida DID's.

### Public blockchain DID's

These are public blockchain DID's that are publicly used to identify a user.

ie: `did:ethr:0xf3beac30c498d9e26865f34fcaa57dbb935b0d74` is a valid DID referencing a valid Ethereum Address.

?><strong>Note:</strong> In theory, private blockchains can also be supported, but the primary use case is public blockchains.

### Verida DID's (VID)

These a Verida DID's generated when a user authenticates with a Verida application for the first time. Every public blockchain DID and application name generates a unique, deterministic Verida DID.

ie: `did:verida:0xc9beac30c498d9e26865f34fcaa57dbb935b0d85` is a valid Verida DID that maps to a known public DID and Verida application.

?><strong>Note:</strong> Most method calls in Verida Datastore require you to provide the Public Blockchain DID and the Verida Application name (via config), however in some instances the Verida DID (vid) is required.

## Multipe Personas

Users can have multiple Personas depending on context. For example, a user may have a `personal` identity and a `professional` identity. This is easily supported (and free) as a user can simply create a new public blockchain DID and use that to login to any application.

It's also entirely anonymous. No information is known about the holder of the DID and no information is written to a public blockchain.

## Data Hosting &amp; Control

Data created by applications is encrypted with the user's private keys and stored in off-chain peer-to-peer databases.

For simplicity, Verida provides a free testnet database that can be used by any application, however both application developers and users can take control of this data:

1. Application developers can host their own Verida Dataserver(s) and configure that to be used for their application. See [configuration](configuration) (VERIDA_APP_HOST).
2. Users can host their own Verida Dataserver(s) and force an application to use that server by updating their DID document with the new server address See [VID Document](#vid-document).

!>Data stored on the Verida testnet is deleted regularly, so don't rely on that data persisting. If you need help spinning up your own dataserver for your application, please contact us.

## Encryption Keys

When a user authenticates with a new application (by signing a consent message with their private key), a new Verida DID (vid) is created, which in turn also creates the following keys:

- **Symmetric encryption key** &mdash; for encrypting private data
- **Asymmetric encryption key** &mdash; for encrypting data for other users and applications
- **Signing key** &mdash; for signing data

The private keys can only be generated from the consent signature generated by the user when they logged into the application. The signature is used as a seed to create a [Hierarchical Deterministic Wallet](https://www.investopedia.com/terms/h/hd-wallet-hierarchical-deterministic-wallet.asp), which in turn, is used to generate child keys.

The public keys are stored in the user's [VID Document](#vid-document) which is public.

## VID Document

When a user is created for the first time, a **VID Document** is created that provides public information about the identity.

Here's an example document:

```
{
  "_id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
  "_rev": "1-16175ffe3a8ad9004ea4268958b41f93",
  "doc": {
    "@context": "https://w3id.org/did/v1",
    "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
    "publicKey": [
      {
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#asym",
        "type": "Curve25519EncryptionPublicKey",
        "controller": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
        "publicKeyHex": "0x3a9db7d3dbc4314e60dcbe2b4e010c084d478ad24fb3c8ccbc5b01f5cf81f46b"
      },
      {
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#sign",
        "type": "Secp256k1VerificationKey2018",
        "controller": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772",
        "publicKeyHex": "0x1ed6be53d8ad36d5869f307ba9c5b762a86f4e9254a41e73e071356343c87580"
      }
    ],
    "authentication": [
      {
        "publicKey": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#sign",
        "type": "Secp256k1SignatureAuthentication2018"
      }
    ],
    "service": [
      {
        "description": "Verida Retail Demo",
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#application",
        "type": "verida.Application",
        "serviceEndpoint": "https://demos.alpha.verida.io:3001"
      },
      {
        "id": "did:vid:0x1cbec5eed940523bdcd1121d51ba3c799cf1b8b74fa77e3e10e4fe0d24b5e772#dataserver",
        "type": "verida.DataServer",
        "serviceEndpoint": "https://dataserver.alpha.verida.io:5000"
      }
    ],
    "created": "2020-02-22T01:30:08.531Z",
    "updated": "2020-02-22T01:30:08.531Z",
    "proof": {
      "alg": "ES256K",
      "signature": "Z6tkB4WJwzXceUoo+WIY3JTsfs4u4vPtfYIZzKWrASVWa5kGf1zWSYxz6uu/fGkSTrRsWgU78f9ppLtG/0lxDw=="
    }
  }
}
```

This is a public document and enables the following capabilities:

1. Encrypt a message for the user (`doc.publicKey.id~#asym`)
1. Verify data the user has signed (`doc.publicKey.id~#sign`)
1. Identify the server where the user's application data is stored (`doc.service.type=verida.DataServer`)
1. Identify the application and it's public URL linked to the VID (`doc.service.type=verida.Application`)

A user's DID Document can only be updated by the user signing a consent message, ensuring the user is in control of their identity.

In this way, users can host their own data. They can then update the `serviceEndpoint` value of their `doc.service.type=verida.DataServer` entry to point to their privately operated dataserver and maintain full control over their data.

While it would only be the most technically literate who would go to that effort, it does open up third party hosting providers to provide different levels of hosting for end users who want more control.

## DID server

Verida maintains a central database (and API) that provides two functions:

- Manages creation and updating of DID documents
- Manages a two way lookup of (DID's + Application name) to Verida DID

This database is accessible via a public API, used internally by the Verida Datastore library.

You can access the [Public API Source Code](https://github.com/verida/did-server). The API is currently deployed at `https://did.alpha.verida.io:5001/`

!>This DID server be replaced with a decentralized solution in the near future (possibly using Sidechain or Ceramic).